---
title: "如何理解微服务架构中的负载均衡和API网关?"
date: 2023-03-12T00:24:55+08:00
categories:
- 架构
tags:
- 架构
keywords:
- 分布式
- architecture
- 微服务
---
![image.png](https://open-native.obs.cn-north-4.myhuaweicloud.com/1*4YiKYTkjpRLAfIg23XxPpA.webp)  
API网关和负载均衡器都是微服务体系结构中非常重要的组件，但它们却发挥着不同的作用，各司其职。  
API网关是所有API请求的唯一入口，其为微服务提供了路由、限流、熔断、认证和鉴权、API版本控制等功能。向上对客户端隐藏了底层微服务的复杂性，向下还对各个领域服务提供防腐层的作用。在宏观上讲，通过上述功能，API网关将不确定性（流量的不确定性、用户行为的不确定性等等）转化为确定性，极大提高了系统的可靠程度。  
<!--more-->
负载均衡器负责在微服务的多个实例之间分发incoming方向请求，以实现高可用用性、高性能和可伸缩性。它有助于在多个实例之间均匀地分布工作负载，并确保每个实例都充分发挥其服务能力。

一句话总结，API网关提供了与API管理相关的higher-level功能，而负载均衡器提供了与微服务的多个实例之间的流量分配相关的 lower-level 功能。

#### 微服务中的API网关

API网关是微服务体系结构中使用的基本模式之一，它作为反向代理将请求从客户端路由到多个内部服务。它还为所有客户端提供与系统交互的单一入口，从而实现对API的更好的可伸缩性、安全性和版本控制。  
假设现在有一个基于微服务架构的电商系统，允许用户浏览和购买产品。该商城由几个微服务组成：商品服务、购物车服务、订单服务和用户服务。  
为了简化客户端和这些微服务之间的交互，可以使用API网关。API网关充当所有客户端请求的单一入口，并将它们路由到适当的微服务。  
例如，当用户查看商品时，客户端向API网关发出请求，网关将请求转发给商品服务。当用户想要下订单时，网关将请求转发给订单服务。  
通过使用API网关，您可以简化客户端代码，减少需要发出的请求数量，并为客户端与微服务交互提供统一的接口。  
![image.png](https://open-native.obs.cn-north-4.myhuaweicloud.com/1*zE0Rj5WUI785qZYrqPkbyQ.webp)  

##### 什么时候使用API网关
当我们知道了什么是API网关以及它提供了什么服务的时候，就很容易理解应该在什么时候去使用它。
1. 为多个微服务提供统一的入口。
2. 实现安全性：API 网关可以为所有微服务强制执行安全策略，例如身份认证可鉴权。
3. 提高性能：API 网关可以缓存来自微服务的响应，并减少到达后端请求的数量。
4. 简化客户端：API 网关可以抽象底层微服务的复杂性，并为客户端提供更简单的交互接口。甚至可以抽象服务之间的请求协议，例如服务之间的PRC协议。
5. 版本控制和路由：API网关可以根据请求参数将请求路由到相同微服务的不同版本或不同的微服务。

所以，它不仅仅是将请求转发到微服务，这是API网关和负载均衡器最主要的区别。

#### 什么是负载均衡器
负载均衡器将传入的网络流量分布到服务器集群中的多个服务器或节点上，不只是在微服务架构中，它可以应用到在任何架构中。  
通过在服务器之间均匀地分配工作负载，它有助于提高应用程序和服务的性能、可伸缩性和可用性。  
通过这种方式，负载均衡器可以确保在其他服务器相对空闲时，没有一台服务器会流量过载，这可以提高资源利用率并提高整个系统的可靠性。  
![image.png](https://open-native.obs.cn-north-4.myhuaweicloud.com/0*5xVRwiiPVj7SnY7t.webp)  

##### 什么时候使用负载均衡器
负载均衡器在微服务架构中，主要将传入的网络流量分布到相同服务的多个实例中。  
负载均衡器可以帮助提高应用程序的可用性和可伸缩性，这就是为什么它们在微服务架构出现之前就已经存在了很长一段时间。  
当应用程序的流量过大，且服务的单个实例无法处理负载时，也会使用负载平衡器。当应用程序跨多个服务器或数据中心部署时，也会使用负载平衡器。

**负载均衡器的优缺点**  
优点:
- 提升性能和可伸缩性：负载均衡器将流量均匀地分布在多个服务器上，降低每个服务器上的负载，并确保没有服务器不堪重负。
- 高可用性和容错性：如果一台服务器发生故障，负载均衡器可以自动将流量重定向到其他健康的服务器，确保即使一些服务器宕机，服务仍然可用。
- 灵活性和可自定义：负载均衡器可以使用不同的算法和规则进行自定义负载策略，以最适合系统特定需求的方式处理流量。

缺点:
- 复杂性和成本：负载均衡器会增加系统的复杂性和成本，因为它们需要额外的硬件或软件来管理和维护。
- 单点故障：负载均衡器本身故障，可能导致整个系统不可用。
- 增加延迟：负载均衡器通过在客户端和服务器之间添加额外的跳点来增加系统延迟。

#### 微服务架构中负载均衡器和API网关的区别
1. 目的  
API网关的主要目的是为微服务提供统一的API，而负载均衡器的主要目的是在多个服务器上均匀地分配流量。
2. 功能  
API网关可以实现路由、安全、负载均衡和API管理等多种功能，而负载均衡器只负责流量分配。
3. 路由  
API网关基于一组预定义的规则去路由请求，而负载均衡器则是基于预定义的算法路由请求，例如轮询或最少连接数，或者是session。
4. 协议支持  
API网关通常支持多种协议，如HTTP、RPC、WebSocket等，而负载均衡器只支持传输层的协议，如TCP和UDP。
5. 安全  
API网关提供诸如身份验证、鉴权和SSL等特性，而负载均衡器只提供诸如SSL等基本安全特性。
6. 缓存  
API网关可以缓存来自微服务的响应以提高性能，而负载均衡器不提供缓存功能。
7. 格式转换  
API网关可以在不同格式之间转换数据，而负载平衡器不提供数据转换功能。
8. 服务发现  
API网关可以与服务发现机制集成以动态发现微服务，而负载均衡器则依赖于静态配置。
9. 颗粒度
API网关可以提供到API端点粒度的精细控制，而负载均衡器只控制服务器级的流量。
10. 可扩展性
API网关可以处理大量的API请求并管理微服务的扩展，而负载均衡器只提供水平扩展功能。

以上就是传统微服务架构中关于API网关和负载均衡器的区别的讨论。



